<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title></title>
	<style>

todo-view {
	display: block;
}

.todo-view__cb-done:checked + .todo-view__text {
	text-decoration: line-through;
}

	</style>
</head>
<body>

<todo-app></todo-app>

<script src="../node_modules/cellx/dist/cellx.js"></script>
<script src="../dist/rionite.polyfills.js"></script>
<script>

var Todo = cellx.EventEmitter.extend({
	constructor: function Todo(text, done) {
		cellx.EventEmitter.call(this);

		cellx.define(this, {
			text: text,
			done: !!done
		});
	}
});

var todos = cellx.list([
	new Todo('Primum', true),
	new Todo('Secundo'),
	new Todo('Tertium')
]);

var TodoView = Rionite.Component.extend('todo-view', {
	Static: {
		input: {
			todo: { type: Object, required: true, readonly: true }
		},

		template: `
			input/cb-done (type=checkbox, checked={todo.done}, rt-change=onCbDoneChange)
			' '
			span/text { '{todo.text}' }
			' '
			button (rt-click=onBtnRemoveClick) { 'remove' }
		`
	},

	initialize() {
		this.todo = this.input.todo;
	},

	onCbDoneChange(evt) {
		this.todo.done = evt.target.checked;
	},

	onBtnRemoveClick() {
		todos.remove(this.todo);
	}
});

Rionite.Component.extend('todo-app', {
	Static: {
		template: `
			input/tf-new-todo
			' '
			button (rt-click=onBtnAddClick) { 'Add #{nextNumber}' }
			div { 'all: {todos.length} done: {doneTodos.length}' }
			@repeat (for=todo of todos) {
				todo-view (todo={todo})
			}
		`
	},

	initialize() {
		cellx.define(this, {
			todos: todos,

			doneTodos: function() {
				return this.todos.filter(function(todo) {
					return todo.done;
				});
			},

			nextNumber: function() {
				return this.todos.length + 1;
			}
		});
	},

	onBtnAddClick() {
		var tfNewTodo = this.$('tf-new-todo');
		todos.add(new Todo(tfNewTodo.value));
		tfNewTodo.value = '';
	}
});

</script>

</body>
</html>