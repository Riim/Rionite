<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title></title>
</head>
<body>

<script src="../node_modules/lodash/lodash.js"></script>
<script src="../node_modules/platform/platform.js"></script>
<script src="../node_modules/benchmark/benchmark.js"></script>
<script>

var range = document.createRange();
var selected = false;

function htmlToFragment(html) {
	if (!selected) {
		range.selectNode(document.body);
		selected = true;
	}

	return range.createContextualFragment(html);
}

function fragment() {
	return htmlToFragment('<ul><li class="li1">1</li><li class="li2">2</li><li class="li3">3</li></ul>');
}

function create() {
	let df = document.createDocumentFragment();
	let ul = document.createElement('ul');
	df.appendChild(ul);
	let li1 = document.createElement('li');
	li1.setAttribute('class', 'li1');
	ul.appendChild(li1);
	let li2 = document.createElement('li');
	li2.setAttribute('class', 'li2');
	ul.appendChild(li2);
	let li3 = document.createElement('li');
	li3.setAttribute('class', 'li3');
	ul.appendChild(li3);
	return df;
}

function clone() {
	return el.cloneNode(true);
}

let el = create();

function bindContent(content) {
	function bind(content) {
		for (let child = content.firstChild; child; child = child.nextSibling) {
			switch (child.nodeType) {
				case Node.ELEMENT_NODE: {
					let attrs = child.attributes;

					for (let i = attrs.length; i; ) {
						let attr = attrs.item(--i);
						let value = attr.value;

						if (value.indexOf('{') != -1) {
							//
						}
					}

					let childComponent = child.$component;

					if (childComponent) {
						//
					}

					if (child.firstChild && (!childComponent || childComponent.constructor.template == null)) {
						bind(child);
					}

					break;
				}
				case Node.TEXT_NODE: {
					let content = child.textContent;

					if (content.indexOf('{') != -1) {
						//
					}

					break;
				}
			}
		}
	}

	bind(content);

	return [null, null];
}

function cloneAndBind() {
	let copy = el.cloneNode(true);
	bindContent(copy);
	return copy;
}

var suite = new Benchmark.Suite();

suite
	.add('fragment', function() {
		fragment();
	})
	.add('create', function() {
		create();
	})
	.add('clone', function() {
		clone();
	})
	.add('cloneAndBind', function() {
		cloneAndBind();
	})
	.on('cycle', function(evt) {
		document.body.innerHTML += '<br>' + String(evt.target);
	})
	.run({ 'async': true });

// fragment x 44,095 ops/sec ±7.46% (51 runs sampled)
// create x 121,499 ops/sec ±6.27% (53 runs sampled)
// clone x 373,003 ops/sec ±7.12% (51 runs sampled)
// cloneAndBind x 58,147 ops/sec ±13.56% (35 runs sampled)

</script>

</body>
</html>